# API Response Guide

This document details the structure of the JSON responses returned by the `/analyze_markdown` endpoint. Frontend developers should use this guide to understand how to parse and use the data in the application's UI.

The API returns one of two possible response objects, depending on the input provided.

---

## 1. Single-File Summary Response

This response is returned when the input `markdown_text` contains only a single release document (i.e., no `--- End of Release Extract ---` separators are found).

It provides a simple, direct summary of the content.

### Structure

```json
{
  "Summary": "string"
}
```

### Fields

-   **`Summary`** (`string`):
    -   A concise, 4-5 bullet-point summary of the key information in the release document.
    -   This is generated by an AI model and is suitable for direct display.

### Example

```json
{
  "Summary": "- New Feature X was successfully launched, improving performance by 15%.\n- Critical security vulnerability CVE-2023-1234 was patched.\n- Fixed a major bug in the data export module.\n- User authentication flow was updated to support multi-factor authentication."
}
```

---

## 2. Multi-File Analysis Response

This response is returned when the input `markdown_text` contains multiple release documents stitched together. This is the primary response object and contains a rich, structured breakdown of the analysis.

### Structure

```json
{
  "metrics": {},
  "report": {},
  "evaluation": {},
  "brief_summary": "string"
}
```

### Fields

#### A. `metrics` (`object`)
This object contains the raw, structured data extracted directly from the release notes by the AI. It is organized by version number where applicable. This data is ideal for creating charts, tables, and quantitative displays.

**Full `metrics` Structure:**
```json
{
  "release_scope": {
    "Target Customers": "<string>",
    "Release Epics": {
      "<version>": { "Total": "<integer>", "Open": "<integer>" }
    },
    "Release PIRs": {
      "<version>": { "Total": "<integer>", "Open": "<integer>" }
    },
    "SFDC Defects Fixed": {
      "<version>": { "ATLs Fixed": "<integer>", "BTLs Fixed": "<integer>" }
    }
  },
  "critical_metrics": {
    "Delivery Against Requirements": {
      "<version>": { "Value": "<percentage>", "Status": "<string>" }
    },
    "System / Solution Test Metrics": {
      "<version>": { "Total": "<integer>", "Open": "<integer>", "Status": "<string>" }
    },
    "System / Solution Test Coverage": {
      "<version>": { "Value": "<percentage>", "Status": "<string>" }
    },
    "System / Solution Test Pass Rate": {
      "<version>": { "Value": "<percentage>", "Status": "<string>" }
    },
    "Security Test Metrics": {
      "<version>": { "Total": "<integer>", "Open": "<integer>", "Status": "<string>" }
    },
    "Performance / Load Test Metrics": {
      "<version>": { "Total": "<integer>", "Open": "<integer>", "Status": "<string>" }
    }
  },
  "health_trends": {
    "Unit Test Coverage": {
      "<version>": {
        "Criteria": "<string>",
        "Previous": "<string>",
        "Current": "<string>",
        "Status": "<string>",
        "Summary": "<string>"
      }
    },
    "Automation Test Coverage": {
      "<version>": {
        "Criteria": "<string>",
        "Previous": "<string>",
        "Current": "<string>",
        "Status": "<string>",
        "Summary": "<string>"
      }
    }
  }
}
```

**Usage for Frontend Visualizations**

The `metrics` object is specifically designed to be easily consumed by charting libraries (like Chart.js, D3.js, ECharts, etc.) to create a visual dashboard. Here are some suggestions for how to map this data to visualizations:

**1. Release Scope (Bar Charts)**

The `release_scope` data is ideal for creating grouped bar charts that compare metrics across different versions.

*   **Example**: Visualizing "Release Epics"
    *   For each version (e.g., "45.1.15.0", "45.2.0.0"), you can create a bar group.
    *   Within each group, create two bars: one for "Total" and one for "Open" epics.
    *   This allows users to quickly see the workload and remaining work for each release.

```javascript
// Example data transformation for a chart library
const releaseScopeData = metrics.release_scope["Release Epics"];
const versions = Object.keys(releaseScopeData); // ["45.1.15.0", "45.2.0.0"]
const totalEpics = versions.map(v => releaseScopeData[v].Total); // [11, 15]
const openEpics = versions.map(v => releaseScopeData[v].Open);   // [0, 4]

// This can then be fed into a bar chart component.
```

**2. Critical Metrics (Gauges or Bar Charts with Status Coloring)**

The `critical_metrics` are perfect for gauges or single bar charts where the color reflects the `Status`.

*   **Example**: Visualizing "System / Solution Test Pass Rate"
    *   You can display the `Value` (e.g., 95%) in a radial gauge or a progress bar.
    *   The color of the gauge/bar can be determined by the `Status` field ("green", "amber", "red"). This provides an immediate visual indicator of health.

```javascript
// Example logic for a gauge component
const passRate = metrics.critical_metrics["System / Solution Test Pass Rate"]["45.1.15.0"];
const value = passRate.Value; // 95
const status = passRate.Status; // "green"

// Use the status to set the color of the gauge.
let color;
if (status === 'green') color = '#28a745';
else if (status === 'amber') color = '#ffc107';
else color = '#dc3545';
```

**3. Health Trends (Line Charts)**

The `health_trends` data is best suited for line charts that show performance over time, comparing the `Previous` and `Current` values across releases.

*   **Example**: Visualizing "Unit Test Coverage"
    *   The x-axis would represent the different versions (releases).
    *   The y-axis would represent the coverage percentage.
    *   You can plot a line for the `Current` value of each version to show the trend. You could also plot the `Previous` value for context.

```javascript
// Example data transformation for a line chart
const trendData = metrics.health_trends["Unit Test Coverage"];
const versions = Object.keys(trendData); // ["45.1.15.0", "45.2.0.0"]
const currentCoverage = versions.map(v => parseFloat(trendData[v].Current)); // [85.2, 84.1]
const previousCoverage = versions.map(v => parseFloat(trendData[v].Previous)); // [85.5, 85.2]

// This data can be used to plot two lines on a line chart.
```

#### B. `report` (`object`)
An AI-generated, **structured JSON report** that provides analysis and interpretation of the `metrics`. This is suitable for building detailed, data-driven tables and summaries in the UI. **Note: This is no longer a narrative markdown report.**

**Full `report` Structure:**
```json
{
  "Overview": "<string>",
  "Metrics Summary": {
    "release_scope_metrics": {
      "Release Epics": [
        { "version": "<string>", "total": "<integer>", "open": "<integer>", "trend": "<string>" }
      ],
      "Release PIRs": [
        { "version": "<string>", "total": "<integer>", "open": "<integer>", "trend": "<string>" }
      ],
      "SFDC DEFECTS FIXED (ATLs)": [
        { "version": "<string>", "value": "<integer>", "trend": "<string>" }
      ],
      "SFDC DEFECTS FIXED (BTLs)": [
        { "version": "<string>", "value": "<integer>", "trend": "<string>" }
      ]
    },
    "critical_metrics": {
      "System / Solution Test Metrics (ATL)": [
        { "version": "<string>", "total": "<integer>", "open": "<integer>", "risk_status": "<string>", "comments": "<string>", "trend": "<string>" }
      ],
      "System / Solution Test Metrics (BTL)": [],
      "Security Test Metrics (ATL)": [],
      "Security Test Metrics (BTL)": [],
      "Performance / Load Test Metrics (ATL)": [],
      "Performance / Load Test Metrics (BTL)": []
    },
    "health_trends": [
      {
        "version": "<string>",
        "metric": "<string>",
        "criteria": "<string>",
        "previous": "<string>",
        "current": "<string>",
        "status": "<string>",
        "summary": "<string>"
      }
    ]
  },
  "Key findings": "<string>",
  "Recommendations": "<string>"
}
```

#### C. `evaluation` (`object`)
An objective, AI-powered evaluation of the generated report's quality, scored against the original source text.

**Full `evaluation` Structure:**
```json
{
  "accuracy": "<percentage>",
  "completeness": "<percentage>",
  "coherence": "<percentage>",
  "relevance": "<percentage>",
  "overall_score": "<percentage>"
}
```

### Example

```json
{
  "metrics": {
    "release_scope": {
      "Target Customers": "Internal",
      "Release Epics": {
        "45.1.15.0": { "Total": 11, "Open": 0 },
        "45.2.0.0": { "Total": 15, "Open": 4 }
      },
      "Release PIRs": {
        "45.1.15.0": { "Total": 20, "Open": 1 },
        "45.2.0.0": { "Total": 25, "Open": 5 }
      },
      "SFDC Defects Fixed": {
        "45.1.15.0": { "ATLs Fixed": 3, "BTLs Fixed": 2 },
        "45.2.0.0": { "ATLs Fixed": 4, "BTLs Fixed": 3 }
      }
    },
    "critical_metrics": {
      "Delivery Against Requirements": {
        "45.1.15.0": { "Value": "100%", "Status": "green" },
        "45.2.0.0": { "Value": "96%", "Status": "green" }
      },
      "System / Solution Test Metrics": {
        "45.1.15.0": { "Total": 100, "Open": 5, "Status": "green" },
        "45.2.0.0": { "Total": 120, "Open": 10, "Status": "amber" }
      },
      "System / Solution Test Coverage": {
        "45.1.15.0": { "Value": "95%", "Status": "green" },
        "45.2.0.0": { "Value": "92%", "Status": "green" }
      },
      "System / Solution Test Pass Rate": {
        "45.1.15.0": { "Value": "98%", "Status": "green" },
        "45.2.0.0": { "Value": "95%", "Status": "green" }
      },
      "Security Test Metrics": {
        "45.1.15.0": { "Total": 20, "Open": 0, "Status": "green" },
        "45.2.0.0": { "Total": 25, "Open": 1, "Status": "amber" }
      },
      "Performance / Load Test Metrics": {
        "45.1.15.0": { "Total": 30, "Open": 0, "Status": "green" },
        "45.2.0.0": { "Total": 35, "Open": 2, "Status": "amber" }
      }
    },
    "health_trends": {
      "Unit Test Coverage": {
        "45.1.15.0": {
          "Criteria": ">= 90%",
          "Previous": "90%",
          "Current": "95%",
          "Status": "green",
          "Summary": "Unit test coverage has improved by 5%."
        },
        "45.2.0.0": {
          "Criteria": ">= 90%",
          "Previous": "95%",
          "Current": "92%",
          "Status": "amber",
          "Summary": "Unit test coverage has decreased by 3%."
        }
      },
      "Automation Test Coverage": {
        "45.1.15.0": {
          "Criteria": ">= 80%",
          "Previous": "85%",
          "Current": "88%",
          "Status": "green",
          "Summary": "Automation test coverage has improved by 3%."
        },
        "45.2.0.0": {
          "Criteria": ">= 80%",
          "Previous": "88%",
          "Current": "85%",
          "Status": "green",
          "Summary": "Automation test coverage has decreased by 3%."
        }
      }
    }
  },
  "report": {
    "Overview": "The release notes for versions 45.1.15.0 and 45.2.0.0 were analyzed to provide insights into the release scope, critical metrics, and health trends. The analysis reveals a positive overall performance, with improvements in unit test coverage and delivery against requirements.",
    "Metrics Summary": {
      "release_scope_metrics": {
        "Release Epics": [
          { "version": "45.1.15.0", "total": 11, "open": 0, "trend": "No open epics." },
          { "version": "45.2.0.0", "total": 15, "open": 4, "trend": "4 open epics, an increase of 33%." }
        ],
        "Release PIRs": [
          { "version": "45.1.15.0", "total": 20, "open": 1, "trend": "1 open PIR, a decrease of 50%." },
          { "version": "45.2.0.0", "total": 25, "open": 5, "trend": "5 open PIRs, an increase of 20%." }
        ],
        "SFDC DEFECTS FIXED (ATLs)": [
          { "version": "45.1.15.0", "value": 3, "trend": "3 ATLs fixed, a decrease of 50%." },
          { "version": "45.2.0.0", "value": 4, "trend": "4 ATLs fixed, an increase of 33%." }
        ],
        "SFDC DEFECTS FIXED (BTLs)": [
          { "version": "45.1.15.0", "value": 2, "trend": "2 BTLs fixed, a decrease of 33%." },
          { "version": "45.2.0.0", "value": 3, "trend": "3 BTLs fixed, an increase of 50%." }
        ]
      },
      "critical_metrics": {
        "System / Solution Test Metrics (ATL)": [
          { "version": "45.1.15.0", "total": 100, "open": 5, "risk_status": "Low", "comments": "5 open tests, a decrease of 50%.", "trend": "Improving." },
          { "version": "45.2.0.0", "total": 120, "open": 10, "risk_status": "Medium", "comments": "10 open tests, an increase of 25%.", "trend": "Deteriorating." }
        ],
        "System / Solution Test Metrics (BTL)": [],
        "Security Test Metrics (ATL)": [],
        "Security Test Metrics (BTL)": [],
        "Performance / Load Test Metrics (ATL)": [],
        "Performance / Load Test Metrics (BTL)": []
      },
      "health_trends": [
        {
          "version": "45.1.15.0",
          "metric": "Unit Test Coverage",
          "criteria": ">= 90%",
          "previous": "90%",
          "current": "95%",
          "status": "green",
          "summary": "Unit test coverage has improved by 5%."
        },
        {
          "version": "45.2.0.0",
          "metric": "Unit Test Coverage",
          "criteria": ">= 90%",
          "previous": "95%",
          "current": "92%",
          "status": "amber",
          "summary": "Unit test coverage has decreased by 3%."
        }
      ]
    },
    "Key findings": "The analysis reveals a positive overall performance, with improvements in unit test coverage and delivery against requirements. However, there is a deterioration in system/solution test metrics for version 45.2.0.0.",
    "Recommendations": "To maintain the positive trend, it is recommended to address the open system/solution tests for version 45.2.0.0 and improve unit test coverage."
  },
  "evaluation": {
    "accuracy": "98%",
    "completeness": "95%",
    "coherence": "97%",
    "relevance": "96%",
    "overall_score": "96%"
  },
  "brief_summary": "The release notes for versions 45.1.15.0 and 45.2.0.0 were analyzed, revealing a positive overall performance with improvements in unit test coverage and delivery against requirements. However, there is a deterioration in system/solution test metrics for version 45.2.0.0."
}
```